<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <record id="ticket_view_form_project" model="ir.ui.view">
        <field name="name">helpdesk.ticket.view.form.inherit</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.ticket_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="project_id" domain="[('partner_id','=',partner_id)]"/>
                <field name="task_id" widget="selection"/>
            </xpath>

            <xpath expr="//group" position="after">
                <notebook>
                    <field name="analytic_account_active" invisible="1"/>
                    <field name="allow_timesheets" invisible="1"/>
                    <page string="Timesheets" attrs="{'invisible': [('allow_timesheets', '=', False)]}">
                        <group>
                            <group>
                                <field name="subtask_count" invisible="1"/>
                                <field name="planned_hours" widget="float_time"/>
                                <label for="subtask_planned_hours" groups="project.group_subtask_project"
                                       attrs="{'invisible': [('subtask_count', '=', 0)]}"/>
                                <div class="o_row" groups="project.group_subtask_project"
                                     attrs="{'invisible': [('subtask_count', '=', 0)]}">
                                    <field name="subtask_planned_hours" widget="float_time"/>
                                    <span>planned hours</span>
                                </div>
                            </group>
                            <group>
                                <field name="progress" widget="progressbar"/>
                            </group>
                        </group>
                        <field name="timesheet_ids" mode="tree,kanban"
                               attrs="{'invisible': [('analytic_account_active', '=', False)]}"
                               context="{'default_project_id': project_id, 'default_name':''}">
                            <tree editable="bottom" string="Timesheet Activities" default_order="date">
                                <field name="date"/>
                                <field name="user_id" invisible="1"/>
                                <field name="employee_id" required="1"/>
                                <field name="name"/>
                                <field name="unit_amount" widget="timesheet_uom"/>
                                <field name="project_id" invisible="1"/>
                            </tree>
                            <form string="Timesheet Activities">
                                <sheet>
                                    <group>
                                        <field name="date"/>
                                        <field name="user_id" invisible="1"/>
                                        <field name="employee_id" required="1"/>
                                        <field name="name"/>
                                        <field name="unit_amount" string="Duration" widget="float_time"/>
                                        <field name="project_id" invisible="1"/>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                        <group attrs="{'invisible': [('analytic_account_active', '=', False)]}">
                            <group class="oe_subtotal_footer oe_right" name="project_hours">
                                <field name="effective_hours" widget="float_time"/>
                                <field name="subtask_effective_hours" widget="float_time"
                                       attrs="{'invisible' : [('subtask_effective_hours', '=', 0.0)]}"/>
                                <field name="total_hours_spent" widget="float_time" class="oe_subtotal_footer_separator"
                                       attrs="{'invisible' : [('subtask_effective_hours', '=', 0.0)]}"/>
                                <field name="remaining_hours" widget="float_time" class="oe_subtotal_footer_separator"/>
                            </group>
                        </group>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>
</odoo>
